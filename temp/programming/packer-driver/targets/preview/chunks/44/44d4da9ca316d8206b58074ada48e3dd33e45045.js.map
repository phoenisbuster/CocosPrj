{"version":3,"sources":["file:///Users/admin/CocosProjects/flappybird/flappybird-cocos/assets/Scripts/Bird.ts"],"names":["_decorator","Component","Input","input","Node","Tween","tween","Vec3","CCFloat","ccclass","property","Bird","type","velocity","isPlayDownTween","groundCollision","isStartGame","onGameOver","RestartBird","_groundCollision","touchRange","on","EventType","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","node","position","event","target","Jump","SetStartSignal","value","_onGameOver","flyForce","stopAllByTarget","to","angle","easing","start","update","deltaTime","gravity","newPosition","y","setPosition","onDestroy","scene","off"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAuBC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AACrEC,MAAAA,O,OAAAA,O;;;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;sBAGjBW,I,WADZF,OAAO,CAAC,MAAD,C,UAEHC,QAAQ,CAACF,OAAD,C,UAGRE,QAAQ,CAACF,OAAD,C,UAGRE,QAAQ,CAACF,OAAD,C,UAERE,QAAQ,CAAC;AAAEE,QAAAA,IAAI,EAAER;AAAR,OAAD,C,2BAVb,MACaO,IADb,SAC0BV,SAD1B,CACoC;AAAA;AAAA;;AAAA;;AAET;AAFS;;AAKT;AALS;;AAQL;AARK;;AAAA,eAYxBY,QAZwB,GAYL,CAZK;AAYF;AAZE,eAaxBC,eAbwB,GAaG,KAbH;AAaU;AAbV,eAcxBC,eAdwB;AAAA,eAexBC,WAfwB,GAeD,KAfC;AAAA,eAiBxBC,UAjBwB,GAiBD,IAjBC;AAAA;;AAmBhCC,QAAAA,WAAW,CAACC,gBAAD,EACX;AACI,eAAKC,UAAL,CAAgBC,EAAhB,CAAmBnB,KAAK,CAACoB,SAAN,CAAgBC,WAAnC,EAAgD,KAAKC,YAArD,EAAmE,IAAnE;AACA,eAAKJ,UAAL,CAAgBC,EAAhB,CAAmBnB,KAAK,CAACoB,SAAN,CAAgBG,SAAnC,EAA8C,KAAKC,UAAnD,EAA+D,IAA/D;AACAvB,UAAAA,KAAK,CAACkB,EAAN,CAASnB,KAAK,CAACoB,SAAN,CAAgBC,WAAzB,EAAsC,KAAKC,YAA3C,EAAyD,IAAzD;AACA,eAAKG,IAAL,CAAUC,QAAV,GAAqB,IAAIrB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,CAArB;AACA,eAAKQ,eAAL,GAAuBI,gBAAvB;AACH;;AAEDO,QAAAA,UAAU,CAACG,KAAD,EAAoB,CAAE;;AAChCL,QAAAA,YAAY,CAACK,KAAD,EACZ;AACI,cAAMC,MAAM,GAAGD,KAAK,CAACC,MAArB;AACA,eAAKC,IAAL;AACH;;AAEDC,QAAAA,cAAc,CAACC,KAAD,EAAiBC,WAAjB,EACd;AACI,eAAKlB,WAAL,GAAmBiB,KAAnB;AACA,eAAKhB,UAAL,GAAkBiB,WAAlB;AACH;;AAEDH,QAAAA,IAAI,GACJ;AACI;AACA,eAAKlB,QAAL,GAAgB,KAAKsB,QAArB;AACA,eAAKrB,eAAL,GAAuB,KAAvB;AACAT,UAAAA,KAAK,CAAC+B,eAAN,CAAsB,KAAKT,IAA3B;AACArB,UAAAA,KAAK,CAAC,KAAKqB,IAAN,CAAL,CAAiBU,EAAjB,CAAoB,GAApB,EAAyB;AAAEC,YAAAA,KAAK,EAAE;AAAT,WAAzB,EAAwC;AAAEC,YAAAA,MAAM,EAAE;AAAV,WAAxC,EAA8DC,KAA9D;AACH;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EACN;AACI,cAAG,CAAC,KAAK1B,WAAT,EACI,OAFR,CAII;;AACA,eAAKH,QAAL,IAAiB,KAAK8B,OAAL,GAAeD,SAAhC,CALJ,CAOI;;AACA,cAAIE,WAAiB,GAAG,KAAKjB,IAAL,CAAUC,QAAlC;AACAgB,UAAAA,WAAW,CAACC,CAAZ,IAAiB,KAAKhC,QAAL,GAAgB6B,SAAjC;AACA,eAAKf,IAAL,CAAUmB,WAAV,CAAsBF,WAAtB,EAVJ,CAWI;;AAEA,cAAG,KAAK/B,QAAL,GAAgB,CAAnB,EACA;AACI,gBAAG,CAAC,KAAKC,eAAT,EACA;AACIT,cAAAA,KAAK,CAAC+B,eAAN,CAAsB,KAAKT,IAA3B;AACArB,cAAAA,KAAK,CAAC,KAAKqB,IAAN,CAAL,CAAiBU,EAAjB,CAAoB,GAApB,EAAyB;AAAEC,gBAAAA,KAAK,EAAE,CAAC;AAAV,eAAzB,EAAyC;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAAzC,EAA+DC,KAA/D;AACA,mBAAK1B,eAAL,GAAuB,IAAvB;AACH;AACJ;;AAED,cAAI,KAAKa,IAAL,CAAUC,QAAV,CAAmBiB,CAAnB,GAAuB,CAAC,KAAK9B,eAAjC,EACI,KAAKE,UAAL,IAAmB,KAAKA,UAAL,EAAnB;AAEP;;AAED8B,QAAAA,SAAS,GACT;AACI;AACA,eAAKpB,IAAL,CAAUqB,KAAV,CAAgBC,GAAhB,CAAoB7C,IAAI,CAACkB,SAAL,CAAeC,WAAnC,EAAgD,KAAKC,YAArD,EAAmE,IAAnE;AACH;;AAnF+B,O;;;;;iBAEd,CAAC,E;;;;;;;iBAGA,E;;;;;;;iBAGG,CAAC,E","sourcesContent":["import { _decorator, Component, EventTouch, Input, input, Node, Tween, tween, Vec3 } from 'cc';\nimport { CCFloat } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Bird')\nexport class Bird extends Component {\n    @property(CCFloat)\n    gravity: number = -10; // Lực rơi xuống của bird\n\n    @property(CCFloat)\n    flyForce: number = 15; // Lực bay lên khi touch vào màn hình\n\n    @property(CCFloat)\n    maxRotation: number = -45; // Góc xoay tối đa khi rơi xuống\n    @property({ type: Node })\n    public touchRange: Node;\n\n    private velocity: number = 0; // Vận tốc của bird\n    private isPlayDownTween: boolean = false; // Kiểm tra trạng thái touch\n    private groundCollision: number;\n    private isStartGame: boolean = false;\n\n    private onGameOver: Function = null;\n\n    RestartBird(_groundCollision: number)\n    {\n        this.touchRange.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.touchRange.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.position = new Vec3(0, 0, 0);\n        this.groundCollision = _groundCollision;\n    }\n\n    onTouchEnd(event: EventTouch) {}\n    onTouchStart(event: EventTouch) \n    {\n        const target = event.target as Node;\n        this.Jump();\n    }\n\n    SetStartSignal(value: boolean, _onGameOver: Function)\n    {\n        this.isStartGame = value;\n        this.onGameOver = _onGameOver;\n    }\n\n    Jump() \n    {\n        // Khi người chơi chạm vào màn hình, set vận tốc lên giá trị của flyForce\n        this.velocity = this.flyForce;\n        this.isPlayDownTween = false;\n        Tween.stopAllByTarget(this.node);\n        tween(this.node).to(0.1, { angle: 25 }, { easing: 'linear' }).start();\n    }\n\n    update(deltaTime: number) \n    {\n        if(!this.isStartGame)\n            return;\n\n        // Cập nhật vận tốc theo trọng lực\n        this.velocity += this.gravity * deltaTime;\n\n        // Cập nhật vị trí bird theo vận tốc\n        let newPosition: Vec3 = this.node.position;\n        newPosition.y += this.velocity * deltaTime;\n        this.node.setPosition(newPosition);\n        // Xử lý xoay bird theo chiều rơi và bay\n\n        if(this.velocity < 0) \n        {\n            if(!this.isPlayDownTween) \n            {\n                Tween.stopAllByTarget(this.node);\n                tween(this.node).to(1.5, { angle: -75 }, { easing: 'linear' }).start();\n                this.isPlayDownTween = true;\n            }\n        }\n\n        if (this.node.position.y < -this.groundCollision)\n            this.onGameOver && this.onGameOver();\n\n    }\n\n    onDestroy() \n    {\n        // Hủy sự kiện touch khi node bị hủy\n        this.node.scene.off(Node.EventType.TOUCH_START, this.onTouchStart, this);\n    }\n}\n\n\n"]}